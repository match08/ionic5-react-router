{"version":3,"file":"StackManager.js","sourceRoot":"","sources":["../../src/ReactRouter/StackManager.tsx"],"names":[],"mappings":"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","sourcesContent":["import {\n  RouteInfo,\n  RouteManagerContext,\n  StackContext,\n  StackContextState,\n  ViewItem,\n  generateId,\n  getConfig\n} from '@ionic/react';\nimport React from 'react';\nimport { matchPath } from 'react-router-dom';\n\nimport { clonePageElement } from './clonePageElement';\n\ninterface StackManagerProps {\n  routeInfo: RouteInfo;\n}\n\ninterface StackManagerState { }\n\nexport class StackManager extends React.PureComponent<StackManagerProps, StackManagerState> {\n  id: string;\n  context!: React.ContextType<typeof RouteManagerContext>;\n  ionRouterOutlet?: React.ReactElement;\n  routerOutletElement: HTMLIonRouterOutletElement | undefined;\n\n  stackContextValue: StackContextState = {\n    registerIonPage: this.registerIonPage.bind(this),\n    isInOutlet: () => true\n  };\n\n  constructor(props: StackManagerProps) {\n    super(props);\n    this.registerIonPage = this.registerIonPage.bind(this);\n    this.transitionPage = this.transitionPage.bind(this);\n    this.handlePageTransition = this.handlePageTransition.bind(this);\n    this.id = generateId('routerOutlet');\n  }\n\n  componentDidMount() {\n    if (this.routerOutletElement) {\n      this.setupRouterOutlet(this.routerOutletElement);\n      // console.log(`SM Mount - ${this.routerOutletElement.id} (${this.id})`);\n      this.handlePageTransition(this.props.routeInfo);\n    }\n  }\n\n  componentDidUpdate(prevProps: StackManagerProps) {\n    if (this.props.routeInfo.pathname !== prevProps.routeInfo.pathname) {\n      this.handlePageTransition(this.props.routeInfo);\n    }\n  }\n\n  componentWillUnmount() {\n    // console.log(`SM UNMount - ${(this.routerOutletElement?.id as any).id} (${this.id})`);\n    this.context.clearOutlet(this.id);\n  }\n\n  async handlePageTransition(routeInfo: RouteInfo) {\n\n    // If routerOutlet isn't quite ready, give it another try in a moment\n    if (!this.routerOutletElement || !this.routerOutletElement.commit) {\n      setTimeout(() => this.handlePageTransition(routeInfo), 10);\n    } else {\n      let enteringViewItem = this.context.findViewItemByRouteInfo(routeInfo, this.id);\n      let leavingViewItem = this.context.findLeavingViewItemByRouteInfo(routeInfo, this.id);\n\n      if (!leavingViewItem && routeInfo.prevRouteLastPathname) {\n        leavingViewItem = this.context.findViewItemByPathname(routeInfo.prevRouteLastPathname, this.id);\n      }\n\n      // Check if leavingViewItem should be unmounted\n      if (leavingViewItem) {\n        if (routeInfo.routeAction === 'replace') {\n          leavingViewItem.mount = false;\n        } else if (!(routeInfo.routeAction === 'push' && routeInfo.routeDirection === 'forward')) {\n          if (routeInfo.routeDirection !== 'none' && (enteringViewItem !== leavingViewItem)) {\n            leavingViewItem.mount = false;\n          }\n        } else if (routeInfo.routeOptions?.unmount) {\n          leavingViewItem.mount = false;\n        }\n      }\n\n      const enteringRoute = matchRoute(this.ionRouterOutlet?.props.children, routeInfo) as React.ReactElement;\n      if (enteringViewItem) {\n        enteringViewItem.reactElement = enteringRoute;\n      }\n      if (!enteringViewItem) {\n        if (enteringRoute) {\n          enteringViewItem = this.context.createViewItem(this.id, enteringRoute, routeInfo);\n          this.context.addViewItem(enteringViewItem);\n        }\n      }\n      if (enteringViewItem && enteringViewItem.ionPageElement) {\n        this.transitionPage(routeInfo, enteringViewItem, leavingViewItem);\n      } else if (leavingViewItem && !enteringRoute && !enteringViewItem) {\n        // If we have a leavingView but no entering view/route, we are probably leaving to\n        // another outlet, so hide this leavingView. We do it in a timeout to give time for a\n        // transition to finish.\n        // setTimeout(() => {\n        if (leavingViewItem.ionPageElement) {\n          leavingViewItem.ionPageElement.classList.add('ion-page-hidden');\n          leavingViewItem.ionPageElement.setAttribute('aria-hidden', 'true');\n        }\n        // }, 250);\n      }\n\n      this.forceUpdate();\n    }\n  }\n\n  registerIonPage(page: HTMLElement, routeInfo: RouteInfo) {\n    const foundView = this.context.findViewItemByRouteInfo(routeInfo, this.id);\n    if (foundView) {\n      foundView.ionPageElement = page;\n      foundView.ionRoute = true;\n    }\n    this.handlePageTransition(routeInfo);\n  }\n\n  async setupRouterOutlet(routerOutlet: HTMLIonRouterOutletElement) {\n\n    const canStart = () => {\n      const config = getConfig();\n      const swipeEnabled = config && config.get('swipeBackEnabled', routerOutlet.mode === 'ios');\n      if (swipeEnabled) {\n        return this.context.canGoBack();\n      } else {\n        return false;\n      }\n    };\n\n    const onStart = () => {\n      this.context.goBack();\n    };\n    routerOutlet.swipeHandler = {\n      canStart,\n      onStart,\n      onEnd: _shouldContinue => true\n    };\n  }\n\n  async transitionPage(routeInfo: RouteInfo, enteringViewItem: ViewItem, leavingViewItem?: ViewItem) {\n\n    const routerOutlet = this.routerOutletElement!;\n\n    const direction = (routeInfo.routeDirection === 'none' || routeInfo.routeDirection === 'root')\n      ? undefined\n      : routeInfo.routeDirection;\n\n    if (enteringViewItem && enteringViewItem.ionPageElement && this.routerOutletElement) {\n      if (leavingViewItem && leavingViewItem.ionPageElement && (enteringViewItem === leavingViewItem)) {\n        // If a page is transitioning to another version of itself\n        // we clone it so we can have an animation to show\n\n        const match = matchComponent(leavingViewItem.reactElement, routeInfo.pathname, true);\n        if (match) {\n          const newLeavingElement = clonePageElement(leavingViewItem.ionPageElement.outerHTML);\n          if (newLeavingElement) {\n            this.routerOutletElement.appendChild(newLeavingElement);\n            await runCommit(enteringViewItem.ionPageElement, newLeavingElement);\n            this.routerOutletElement.removeChild(newLeavingElement);\n          }\n        } else {\n          await runCommit(enteringViewItem.ionPageElement, undefined);\n        }\n      } else {\n        await runCommit(enteringViewItem.ionPageElement, leavingViewItem?.ionPageElement);\n        if (leavingViewItem && leavingViewItem.ionPageElement) {\n          leavingViewItem.ionPageElement.classList.add('ion-page-hidden');\n          leavingViewItem.ionPageElement.setAttribute('aria-hidden', 'true');\n        }\n      }\n    }\n\n    async function runCommit(enteringEl: HTMLElement, leavingEl?: HTMLElement) {\n      enteringEl.classList.add('ion-page');\n      enteringEl.classList.add('ion-page-invisible');\n\n      await routerOutlet.commit(enteringEl, leavingEl, {\n        deepWait: true,\n        duration: direction === undefined ? 0 : undefined,\n        direction: direction as any,\n        showGoBack: direction === 'forward',\n        progressAnimation: false,\n        animationBuilder: routeInfo.routeAnimation\n      });\n    }\n  }\n\n  render() {\n    const { children } = this.props;\n    const ionRouterOutlet = React.Children.only(children) as React.ReactElement;\n    this.ionRouterOutlet = ionRouterOutlet;\n\n    const components = this.context.getChildrenToRender(\n      this.id,\n      this.ionRouterOutlet,\n      this.props.routeInfo,\n      () => {\n        this.forceUpdate();\n      });\n\n    return (\n      <StackContext.Provider value={this.stackContextValue}>\n        {React.cloneElement(ionRouterOutlet as any, {\n          ref: (node: HTMLIonRouterOutletElement) => {\n            if (ionRouterOutlet.props.setRef) {\n              ionRouterOutlet.props.setRef(node);\n            }\n            if (ionRouterOutlet.props.forwardedRef) {\n              ionRouterOutlet.props.forwardedRef.current = node;\n            }\n            this.routerOutletElement = node;\n            const { ref } = ionRouterOutlet as any;\n            if (typeof ref === 'function') {\n              ref(node);\n            }\n          }\n        },\n          components\n        )}\n      </StackContext.Provider>\n    );\n  }\n\n  static get contextType() {\n    return RouteManagerContext;\n  }\n}\n\nexport default StackManager;\n\nfunction matchRoute(node: React.ReactNode, routeInfo: RouteInfo) {\n  let matchedNode: React.ReactNode;\n  React.Children.forEach(node as React.ReactElement, (child: React.ReactElement) => {\n    const matchProps = {\n      exact: child.props.exact,\n      path: child.props.path || child.props.from,\n      component: child.props.component\n    };\n    const match = matchPath(routeInfo.pathname, matchProps);\n    if (match) {\n      matchedNode = child;\n    }\n  });\n\n  if (matchedNode) {\n    return matchedNode;\n  }\n  // If we haven't found a node\n  // try to find one that doesn't have a path or from prop, that will be our not found route\n  React.Children.forEach(node as React.ReactElement, (child: React.ReactElement) => {\n    if (!(child.props.path || child.props.from)) {\n      matchedNode = child;\n    }\n  });\n\n  return matchedNode;\n}\n\nfunction matchComponent(node: React.ReactElement, pathname: string, forceExact?: boolean) {\n  const matchProps = {\n    exact: forceExact ? true : node.props.exact,\n    path: node.props.path || node.props.from,\n    component: node.props.component\n  };\n  const match = matchPath(pathname, matchProps);\n\n  return match;\n}\n"]}